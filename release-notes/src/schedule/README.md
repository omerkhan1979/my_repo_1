# Automated Statuspage Scheduled Maintenance Window creation
This automation creates Scheduled Maintenance windows that we send to Statuspage becuase StatusPage does not allow for enhanced scheduled incidents like bi-weekly scheduling of events. The data generated by this automation must be reviewed against the MFC Change Calendar (which is treated as the Source of Truth in this case), updated accordingly, and then merged in order to send the data to Statuspage. 

Once the data is sent to Statuspage, notifications are automatically sent to clients with details about their upcoming Scheduled Maintenance. After the Scheduled Maintenance events are created in Statuspage, a subsequent PR is generated in this repo with a list of unique IDs for each Scheduled Maintenace event, which must also be merged. 

### How to Review and Merge the Scheduled Maintenance JSON
On even Wednesdays at Noon (12:00PM) EST, [statuspage_maint.yml](https://github.com/takeoff-com/release-notes/blob/master/.github/workflows/statuspage_maint.yml) is triggered. A PR titled `maintenance events MAINT_WINDOWS_RT[ww-yy]` gets created for `Window_Times.json` with an updated json payload. Once that PR gets generated, you need to: 

1. Open `Window_Times.json` in Edit mode.
2. For each client, review their scheduled maintenance event for the upcoming RT against the event in the [MFC Change Calendar](https://calendar.google.com/calendar/u/0?cid=dGFrZW9mZi5jb21fcmViNGRldnJhamg4dHU1bmRhaHJwa3BkazRAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ). Making sure `scheduled_for` and `scheduled_until` **date** and **time** match what is in the calendar.
- If the client's deploy window has been cancelled due to codefreeze, or punted from the RT, etc, delete the entire `incident` object for that client.
- When checking the `scheduled_for` and `scheduled_until` data, the easiest way to do this is to convert from your local time as listed in Google Calendar to UTC with [worldtimebuddy.com](worldtimebuddy.com). For example if your local time zone on Google Calendar is US Eastern, use worldtimebuddy.com to convert that to UTC, then check that against the `scheduled_for` and `scheduled_until` date and time. 
Again, it is critical to **check every incident** and make sure it is aligned with the MFC Change Calendar.
3. Once everything is checked and updated, commit your changes and merge the PR. This triggers the creation of all Statuspage Scheduled Maintenance windows and you will start to see notificaions go out to clients in [#statuspage-maintenance-events](https://takeofftech.slack.com/archives/C03RBAGFSBF). Double check the [Send Statuspage Maintenance Windows](https://github.com/takeoff-com/release-notes/actions/workflows/send_statuspage_maint.yml) workflow to make sure it completed successfully (e.g., if you had a typo in your json data, it will create some Scheduled Maintenance windows, but not all).
4. Once that workflow is complete, a new PR titled Maintenance file FILE_MAINT_WINDOWS_RT[ww-yy] will be generated (e.g., [Maintenance file FILE_MAINT_WINDOWS_RT48-23](https://github.com/takeoff-com/release-notes/pull/609). That PR must also be merged in order to allow [closeMaintenanceWindw.sh in the Release Train Management repo](https://github.com/takeoff-com/release-train-management/blob/master/scripts/closeMaintenanceWindow.sh) to automatically mark the Scheduled Maintenance as Complete for each client once the RT deployment to Prod is done. 
